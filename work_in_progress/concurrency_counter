# CONCURRENCY COUNTER v1.1
# by: Leif Gatmaitan
# created: 28/11/2025
# last_update: 29/11/2025

from cc_convert_time import convert_time
from cc_count_concurrency import count_concurrency
from cc_identify_2or3 import identify_count

filename = 'test.csv'
# enter .csv filename or source here here
# table columns must be in the ff format: Convo ID, start, end
# times must be in 24h format

with open(filename) as file:
	content = file.readlines()

data = []
for line in content:
	data.append(line.rstrip().split(","))
data = convert_time(data)
del data[0] # deletes the header

concurrencies = count_concurrency(data)
# count_concurrency() returns a dictionary
# key is the conversation id
# value, is the list of the conversation ID's it overlaps with, including self


concurrency_2 = {}
#removes redundancy in values list by transforming it from list into set
for key, value in concurrencies.items():
	concurrency_2[key] = set(value)

concurrency_count = {}
for key, value in concurrency_2.items():
	concurrency_count[key] = len(value)

#grouping chat_id's by number of overlaps
concurrency_single = []
concurrency_double = []
concurrency_triple = []
concurrency_many = [] #perliminary group, will check if concurrency is 2 or 3

for key, value in concurrency_count.items():
	if value == 1:
		concurrency_single.append(key)
	elif value == 2:
		concurrency_double.append(key)
	else:
		concurrency_many.append(key)

# For many concurrencies, I will check if chat_id is overlapping
# the with the same chat multiple times or with multiple chats

identified = identify_count(concurrency_many, concurrency_2)

for chat_id in identified[0]:
	concurrency_double.append(chat_id)
for chat_id in identified[1]:
	concurrency_triple.append(chat_id)

print(concurrency_single)
print(concurrency_double)
print(concurrency_triple)
print(len(concurrency_single) + len(concurrency_double) + len(concurrency_triple))
